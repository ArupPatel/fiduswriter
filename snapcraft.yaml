name: fiduswriter
adopt-info: fiduswriter
summary: 'An academic collaborative word processor'
base: core18
confinement: strict
grade: devel
parts:
  fiduswriter:
    plugin: python
    python-version: python3
    parse-info:
      - setup.py
    source: .
    filesets:
      exclude:
        - '-lib/python3.6/site-packages/fiduswriter/configuration.py'
        - '-lib/python3.6/site-packages/fiduswriter/payment'
    stage:
      - $exclude
    override-build: |
      rm -f fiduswriter/configuration.py
      snapcraftctl build
    requirements:
      - fiduswriter/requirements.txt
    stage-packages:
      - libjpeg-dev
      - python3-dev
      - python3-pip
      - python3-distutils
      - gettext
      - zlib1g-dev
      - wget
      - build-essential
      - libmagic1
    after:
      - node
  node:
    plugin: nodejs
    nodejs-package-manager: npm
    source: ./travis
    override-pull: |
      echo '{"name": "fiduswriter", "version": "1.0.0", "dependencies": {"npm": "*"}, "bin": {"npm": "node_modules/.bin/npm"}}' > package.json
      snapcraftctl pull
      rm -f configuration.py
apps:
  fiduswriter:
    command: 'bin/fiduswriter --pythonpath $SNAP_USER_DATA'
    plugs:
      - network-bind
      - network-control
      - network-observe
layout:
  /etc/magic:
    bind-file: $SNAP/etc/magic
  /etc/wgetrc:
    bind-file: $SNAP/etc/wgetrc
